trigger:
- main
- release/*
pr:
- none

jobs:
- job:
  strategy:
    matrix:
      Linux:
        imageName: 'ubuntu-latest'
        platformName: 'Gtk'
        artifactName: 'Linux-v0.1-$(Build.BuildNumber)'
      macOS:
        imageName: 'macOS-latest'
        platformName: 'Mac'
        artifactName: 'macOS-v0.1-$(Build.BuildNumber)'
      Windows:
        imageName: 'windows-latest'
        platformName: 'Wpf'
        artifactName: 'Windows-v0.1-$(Build.BuildNumber)'
  displayName: Build & Publish
  pool:
    vmImage: $(imageName)
  steps:
  - checkout: self
    clean: true
    
  - task: DotNetCoreCLI@2
    inputs:
      command: 'publish'
      projects: $(Build.SourcesDirectory)/src/SerialLoops.$(platformName)/SerialLoops.$(platformName).csproj
      arguments: '-c Release -o $(Build.ArtifactStagingDirectory)'
      publishWebProjects: false
    displayName: Build & Publish Serial Loops

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)'
      ArtifactName: '$(artifactName)'
      publishLocation: 'Container'
    displayName: Publish build artifacts
    
  - task: GitHubRelease@1
    displayName: 'Create GitHub Pre-Release'
    inputs:
      gitHubConnection: 'GitHub Connection (Jonko)'
      tagSource: userSpecifiedTag
      tag: '$(Build.BuildNumber)'
      title: 'Serial Loops'
      releaseNotesSource: inline
      releaseNotesInline: 'Latest build based on main!'
      isPreRelease: true